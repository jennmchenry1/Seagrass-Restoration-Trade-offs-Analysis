---
title: "0. eagrass Restoration STradeoffs Paper - Post Processing Spatial Datasets"
author: "Jennifer McHenry"
date: "7/21/2022"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE, warning = FALSE, fig.pos = "H", out.extra = "")

#Load Libraries

library(tidyverse)
library(RColorBrewer)
library(mgcv)
library(tools)
library(viridis)
library(ggpubr)
# library(ggsn)
library(remotes)
library(raster)
# remotes::install_version("Rttf2pt1", version = "1.3.8")
library(extrafont)
library(ggcorrplot)
# extrafont::font_import() 
loadfonts("win")
library(ggplot2)
library(corrplot)
library(colorspace)
library(rgeos)

#Load Functions 
pal_teal_blue_purple <- rainbow(12)

odds_to_prob=function(x){
        prob<-exp(x)/(1+exp(x))
        return(prob)
}

#Setting Directory Paths
wd=getwd()

username=as.vector(strsplit(wd,"/"));names(username)<-c("username")

Saved_RData_Dir=paste("C:/Users/",username$username[3],"/Dropbox/GITHUB/Disseratation/",sep="")

```

```{r}
#LOADING DATASETS FOR THE ANALYSIS 

#SEAGRASS LAYERS#######################################################################################################################

#Total Predicted_Seagrass
Seagrass_Cover=raster(paste(Saved_RData_Dir,"Modeling_Biodiversity_Enhancement_Value/model_output/August_2020_seagrassmodel_predictions/Annual_Predictions/Seagrass_Cover_MeanAnnual_Current_Corrected_CorExp.tif",sep=""))
names(Seagrass_Cover)<-c("Seagrass_Cover")

Total_Predicted_Seagrass=Seagrass_Cover
Total_Predicted_Seagrass[Total_Predicted_Seagrass<5]<-NA
Total_Predicted_Seagrass[Total_Predicted_Seagrass>=5]<-0

# Study area
study_area<-raster("input_data/study_area.tif")

#masking the seagrass datasets
Total_Predicted_Seagrass=mask(Total_Predicted_Seagrass,mask = study_area)

#Confirmed Seagrass Areas
PRAs=raster("input_data/seagrass_area_masks/potential_recovery_area.tif")
PRAs=mask(PRAs,mask = study_area)

Seagrass_Cover_PRAs=mask(Seagrass_Cover,mask=PRAs)


#loading regions raster
FCMap=raster("input_data/FCMaP_Workshop_Regions/FCMaP.tif")
FCMap=resample(x=FCMap,y = study_area,method="ngb")


#ECOSYSTEM SERVICE LAYERS##############################################################################################################

#Loading ES Outputs (Standarized)
BioDiv_EV=raster("input_data/ES-Model-Outputs/BioDiv_EV_Zscores_PRAs.tif")
NurHab_EV=raster("input_data/ES-Model-Outputs/NursHab_EV_Zscores_PRAs.tif")
Gray_Snapper_EV=raster("input_data/ES-Model-Outputs/Gray_Snapper_EV_Zscores_PRAs.tif")
Lane_Snapper_EV=raster("input_data/ES-Model-Outputs/Lane_Snapper_EV_Zscores_PRAs.tif")
White_Grunt_EV=raster("input_data/ES-Model-Outputs/White_Grunt_EV_Zscores_PRAs.tif")
Spotted_Seatrout_EV=raster("input_data/ES-Model-Outputs/Spotted_Seatrout_EV_Zscores_PRAs.tif")
Sheepshead_EV=raster("input_data/ES-Model-Outputs/Sheepshead_EV_Zscores_PRAs.tif")
Pink_Shrimp_EV=raster("input_data/ES-Model-Outputs/Pink_Shrimp_EV_Zscores_PRAs.tif")
BlueCar_EV=raster("input_data/ES-Model-Outputs/BC_Storage_EV_Zscores_PRAs.tif")
RecTour_EV=raster("input_data/ES-Model-Outputs/Rec_EV_Zscores_PRAs.tif")
Expos_EV=raster("input_data/ES-Model-Outputs/Exposure_EV_Zscores_PRAs.tif")
Pop_EV=raster("input_data/ES-Model-Outputs/Population_EV_Zscores_PRAs.tif")

ES_Zscores=stack(FCMap,Seagrass_Cover_PRAs,BioDiv_EV,NurHab_EV,Gray_Snapper_EV,Lane_Snapper_EV,White_Grunt_EV,Spotted_Seatrout_EV,Sheepshead_EV,Pink_Shrimp_EV,BlueCar_EV,RecTour_EV,Expos_EV,Pop_EV)

ES_Zscores=mask(ES_Zscores,mask=PRAs)
ES_Zscores_df=as.data.frame(rasterToPoints(ES_Zscores))
names(ES_Zscores_df)<-c("x","y","Regions","Seagrass_Cover","BioDiv","NurHab","Gray_Snapper","Lane_Snapper","White_Grunt","Spotted_Seatrout","Sheepshead","Pink_Shrimp","BlueCar","RecTour","Expos","Pop")
ES_Zscores_df<-ES_Zscores_df[complete.cases(ES_Zscores_df),]
summary(ES_Zscores_df)

dim(ES_Zscores_df)

write.csv(ES_Zscores_df,file = "processed_datasets/ES_ZScores_PRAs.csv")
writeRaster(ES_Zscores,"processed_datasets/ES_ZScores_PRAs.grd", format="raster")
```

